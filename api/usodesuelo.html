<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Clases y métodos para extraer y procesar información sobre el uso de suelo.">

<title>pyLandUseMX - Uso de Suelo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="pyLandUseMX - Uso de Suelo">
<meta property="og:description" content="Clases y métodos para extraer y procesar información sobre el uso de suelo.">
<meta property="og:site-name" content="pyLandUseMX">
<meta name="twitter:title" content="pyLandUseMX - Uso de Suelo">
<meta name="twitter:description" content="Clases y métodos para extraer y procesar información sobre el uso de suelo.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="https://www.centrogeo.org.mx/" class="navbar-brand navbar-brand-logo">
    <img src="../logo_centrogeo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">pyLandUseMX</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/CentroGeo/pyLandUseMX"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/plablo09"><i class="bi bi-twitter" role="img" aria-label="plablo09 Twitter">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Uso de Suelo</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">pyLandUseMX</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">Tutoriales</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutoriales/extraccion_actividades.html" class="sidebar-item-text sidebar-link">Extracción de actividades del DENUE</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutoriales/vialidades.html" class="sidebar-item-text sidebar-link">Agregación de vialidades</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">API</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/descargas.html" class="sidebar-item-text sidebar-link">Descargas</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/usodesuelo.html" class="sidebar-item-text sidebar-link active">Uso de Suelo</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/denue.html" class="sidebar-item-text sidebar-link">Denue</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/analisis.html" class="sidebar-item-text sidebar-link">Análisis</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Fuentes</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../fuentes/censo.html" class="sidebar-item-text sidebar-link">Datos del Censo</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#soporte-espacial" id="toc-soporte-espacial" class="nav-link active" data-scroll-target="#soporte-espacial">Soporte espacial</a>
  <ul class="collapse">
  <li><a href="#soporte" id="toc-soporte" class="nav-link" data-scroll-target="#soporte">Soporte</a></li>
  <li><a href="#mallas" id="toc-mallas" class="nav-link" data-scroll-target="#mallas">Mallas</a></li>
  <li><a href="#malla" id="toc-malla" class="nav-link" data-scroll-target="#malla">Malla</a></li>
  <li><a href="#malla.desde_capa" id="toc-malla.desde_capa" class="nav-link" data-scroll-target="#malla.desde_capa">Malla.desde_capa</a></li>
  <li><a href="#malla.desde_raster-1" id="toc-malla.desde_raster-1" class="nav-link" data-scroll-target="#malla.desde_raster-1">Malla.desde_raster</a></li>
  <li><a href="#malla.to_crs" id="toc-malla.to_crs" class="nav-link" data-scroll-target="#malla.to_crs">Malla.to_crs</a></li>
  <li><a href="#malla.agrega_puntos" id="toc-malla.agrega_puntos" class="nav-link" data-scroll-target="#malla.agrega_puntos">Malla.agrega_puntos</a></li>
  <li><a href="#malla.agrega_lineas" id="toc-malla.agrega_lineas" class="nav-link" data-scroll-target="#malla.agrega_lineas">Malla.agrega_lineas</a></li>
  <li><a href="#malla.agrega_manzanas" id="toc-malla.agrega_manzanas" class="nav-link" data-scroll-target="#malla.agrega_manzanas">Malla.agrega_manzanas</a></li>
  <li><a href="#malla.to_xarray" id="toc-malla.to_xarray" class="nav-link" data-scroll-target="#malla.to_xarray">Malla.to_xarray</a></li>
  <li><a href="#malla.copy" id="toc-malla.copy" class="nav-link" data-scroll-target="#malla.copy">Malla.copy</a></li>
  <li><a href="#polígonos" id="toc-polígonos" class="nav-link" data-scroll-target="#polígonos">Polígonos</a></li>
  <li><a href="#poligonos" id="toc-poligonos" class="nav-link" data-scroll-target="#poligonos">Poligonos</a></li>
  <li><a href="#poligonos.desde_archivo" id="toc-poligonos.desde_archivo" class="nav-link" data-scroll-target="#poligonos.desde_archivo">Poligonos.desde_archivo</a></li>
  <li><a href="#poligonos.to_crs" id="toc-poligonos.to_crs" class="nav-link" data-scroll-target="#poligonos.to_crs">Poligonos.to_crs</a></li>
  <li><a href="#poligonos.agrega_puntos" id="toc-poligonos.agrega_puntos" class="nav-link" data-scroll-target="#poligonos.agrega_puntos">Poligonos.agrega_puntos</a></li>
  <li><a href="#poligonos.agrega_lineas" id="toc-poligonos.agrega_lineas" class="nav-link" data-scroll-target="#poligonos.agrega_lineas">Poligonos.agrega_lineas</a></li>
  <li><a href="#poligonos.agrega_manzanas" id="toc-poligonos.agrega_manzanas" class="nav-link" data-scroll-target="#poligonos.agrega_manzanas">Poligonos.agrega_manzanas</a></li>
  <li><a href="#poligonos.copy" id="toc-poligonos.copy" class="nav-link" data-scroll-target="#poligonos.copy">Poligonos.copy</a></li>
  </ul></li>
  <li><a href="#usodesuelo" id="toc-usodesuelo" class="nav-link" data-scroll-target="#usodesuelo">UsoDeSuelo</a>
  <ul class="collapse">
  <li><a href="#usodesuelo-1" id="toc-usodesuelo-1" class="nav-link" data-scroll-target="#usodesuelo-1">UsoDeSuelo</a></li>
  <li><a href="#agrega-puntos-1" id="toc-agrega-puntos-1" class="nav-link" data-scroll-target="#agrega-puntos-1">Agrega puntos</a></li>
  <li><a href="#usodesuelo.agrega_puntos" id="toc-usodesuelo.agrega_puntos" class="nav-link" data-scroll-target="#usodesuelo.agrega_puntos">UsoDeSuelo.agrega_puntos</a></li>
  <li><a href="#agregar-líneas" id="toc-agregar-líneas" class="nav-link" data-scroll-target="#agregar-líneas">Agregar líneas</a></li>
  <li><a href="#usodesuelo.agrega_lineas" id="toc-usodesuelo.agrega_lineas" class="nav-link" data-scroll-target="#usodesuelo.agrega_lineas">UsoDeSuelo.agrega_lineas</a></li>
  <li><a href="#agregar-variables-del-censo" id="toc-agregar-variables-del-censo" class="nav-link" data-scroll-target="#agregar-variables-del-censo">Agregar variables del censo</a></li>
  <li><a href="#usodesuelo.agrega_manzanas" id="toc-usodesuelo.agrega_manzanas" class="nav-link" data-scroll-target="#usodesuelo.agrega_manzanas">UsoDeSuelo.agrega_manzanas</a></li>
  <li><a href="#calcular-mezclas" id="toc-calcular-mezclas" class="nav-link" data-scroll-target="#calcular-mezclas">Calcular mezclas</a></li>
  <li><a href="#usodesuelo.calcula_mezclas" id="toc-usodesuelo.calcula_mezclas" class="nav-link" data-scroll-target="#usodesuelo.calcula_mezclas">UsoDeSuelo.calcula_mezclas</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/CentroGeo/pyLandUseMX/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Uso de Suelo</h1>
</div>

<div>
  <div class="description">
    Clases y métodos para extraer y procesar información sobre el uso de suelo.
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="soporte-espacial" class="level2">
<h2 class="anchored" data-anchor-id="soporte-espacial">Soporte espacial</h2>
<p>Para trabajar con datos sobre uso de suelo y estructura urbana, necesitamos definir el soporte espacial (entendido como una teselación del espacio de estudio) que va a ser base para estudiar el uso de suelo. Podemos pensar que existen dos tipos generales de soporte espacial: regulares e irregulares. Los soportes regulares cubren el espacio utilizando siempre la misma figura, como en el caso de las mallas rectangulares o hexagonales, por otro lado, los soportes irregulares cubren el espacio con polígonos arbitrarios, como en el caso de los municipios, AGEBs o colonias.</p>
<p>En este módulo incluimos clases y métodos que nos permiten trabajar con diferentes tipos de soporte espacial. Estos métodos pueden ser usados de forma directa, creando objetos de las clases <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#malla"><code>Malla</code></a> o <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#poligonos"><code>Poligonos</code></a> para agregar y calcular variables de uso de suelo y medio construido, o a través de la clase <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#usodesuelo"><code>UsoDeSuelo</code></a> que implementa algunas herramientas de análisis.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L28" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="soporte" class="level3">
<h3 class="anchored" data-anchor-id="soporte">Soporte</h3>
<blockquote class="blockquote">
<pre><code> Soporte ()</code></pre>
</blockquote>
<p>Clase abstracta que define la interfaz para los diferentes tipos de Soporte.</p>
</section>
<section id="mallas" class="level3">
<h3 class="anchored" data-anchor-id="mallas">Mallas</h3>
<p>Algunos tipos de análisis, como las regresiones de uso de suelo para contaminantes atomsféricos, utilizan datos de uso de suelo en mallas. Para este tipo de aplicaciones la librería provee un conjunto de herramientas para crear mallas y agregar datos en ellas.</p>
<p>El primer elemento de este módulo es una Clase para contener la funcionalidad que vamos a implementar. Vamos a comenzar por definir la estructura básica de la clase y luego iremos agregando funcionalidad.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L68" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="malla" class="level3">
<h3 class="anchored" data-anchor-id="malla">Malla</h3>
<blockquote class="blockquote">
<pre><code> Malla (datos:geopandas.geodataframe.GeoDataFrame=None, size:float=1000)</code></pre>
</blockquote>
<p>Representa una malla para procesar variables de uso de suelo.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>datos</td>
<td>GeoDataFrame</td>
<td>None</td>
<td>La malla vectorial</td>
</tr>
<tr class="even">
<td>size</td>
<td>float</td>
<td>1000</td>
<td>Tamaño de los elementos de la malla (en las unidades de la proyección de <code>layer</code>)</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>La clase <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#malla"><code>Malla</code></a> contiene dos campos: <code>size</code> y <code>datos</code> con el tamaño de los elementos de la retícula y el <code>GeoDataFrame</code> con los polígonos de la malla respectivamente. Por lo pronto la clase sólo tiene un <em>classmethod</em> que nos permite construir un objeto a partir de una capa vectorial:</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L80" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="malla.desde_capa" class="level3">
<h3 class="anchored" data-anchor-id="malla.desde_capa">Malla.desde_capa</h3>
<blockquote class="blockquote">
<pre><code> Malla.desde_capa (capa:geopandas.geodataframe.GeoDataFrame, size:float)</code></pre>
</blockquote>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>capa</td>
<td>GeoDataFrame</td>
<td>La capa que define la extensión de la malla</td>
</tr>
<tr class="even">
<td>size</td>
<td>float</td>
<td>Tamaño de la malla en unidades de la proyección</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pth <span class="op">=</span> descarga_poligonos_ciudades()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>zmvm <span class="op">=</span> gpd.read_file(pth)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>zmvm <span class="op">=</span> zmvm.loc[zmvm.CVE_SUN <span class="op">==</span> <span class="st">'13'</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>malla <span class="op">=</span> Malla.desde_capa(zmvm, <span class="dv">1000</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>malla.datos.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>El archivo ya está descargado</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-6-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>Podemos ver la malla superpuesta al polígono que usamos para construirla:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>zmvm.plot(ax<span class="op">=</span>ax)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>malla.datos.boundary.plot(ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>
<section id="malla.desde_raster" class="level4">
<h4 class="anchored" data-anchor-id="malla.desde_raster">Malla.desde_raster</h4>
<p>También podemos crear una malla a partir de un raster (p.&nbsp;ej. un geotiff), en este se crea una malla con las mismas características que el raster de entrada.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L102" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="malla.desde_raster-1" class="level3">
<h3 class="anchored" data-anchor-id="malla.desde_raster-1">Malla.desde_raster</h3>
<blockquote class="blockquote">
<pre><code> Malla.desde_raster (raster:Union[str,pathlib.Path])</code></pre>
</blockquote>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>raster</td>
<td>Union</td>
<td>El raster a partir del que vamos a crear la malla.</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pth_raster <span class="op">=</span> descarga_raster_ejemplo()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>malla_raster <span class="op">=</span> Malla.desde_raster(pth_raster)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>malla_raster.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>El archivo ya está descargado
EPSG:4326</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>geometry</th>
      <th>grid_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>POLYGON ((-99.65011 20.06836, -99.65011 20.059...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>POLYGON ((-99.64113 20.06836, -99.64113 20.059...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>POLYGON ((-99.63215 20.06836, -99.63215 20.059...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>POLYGON ((-99.62317 20.06836, -99.62317 20.059...</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>POLYGON ((-99.61418 20.06836, -99.61418 20.059...</td>
      <td>4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>14963</th>
      <td>POLYGON ((-98.63502 18.93649, -98.63502 18.927...</td>
      <td>14963</td>
    </tr>
    <tr>
      <th>14964</th>
      <td>POLYGON ((-98.62604 18.93649, -98.62604 18.927...</td>
      <td>14964</td>
    </tr>
    <tr>
      <th>14965</th>
      <td>POLYGON ((-98.61705 18.93649, -98.61705 18.927...</td>
      <td>14965</td>
    </tr>
    <tr>
      <th>14966</th>
      <td>POLYGON ((-98.60807 18.93649, -98.60807 18.927...</td>
      <td>14966</td>
    </tr>
    <tr>
      <th>14967</th>
      <td>POLYGON ((-98.59909 18.93649, -98.59909 18.927...</td>
      <td>14967</td>
    </tr>
  </tbody>
</table>
<p>14968 rows × 2 columns</p>
</div>
</div>
</div>
<section id="transformación-de-coordenadas" class="level4">
<h4 class="anchored" data-anchor-id="transformación-de-coordenadas">Transformación de coordenadas</h4>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L135" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="malla.to_crs" class="level3">
<h3 class="anchored" data-anchor-id="malla.to_crs">Malla.to_crs</h3>
<blockquote class="blockquote">
<pre><code> Malla.to_crs (to_crs:Union[int,str,pyproj.crs.crs.CRS])</code></pre>
</blockquote>
<p>Se encarga de transformar de coordenadas.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>to_crs</td>
<td>Union</td>
<td>El crs al que queremos reproyectar</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Malla</strong></td>
<td></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>malla_raster_utm <span class="op">=</span> malla_raster.to_crs(<span class="dv">32614</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(malla_raster_utm.crs.to_string(), malla_raster.crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>EPSG:32614 EPSG:4326</code></pre>
</div>
</div>
<section id="secc-malla-puntos" class="level4">
<h4 class="anchored" data-anchor-id="secc-malla-puntos">Agregar puntos en la malla</h4>
<p>Ahora vamos a agregar la funcionalidad para agregar una capa de puntos en la Malla.</p>
<p><strong>Nota:</strong> el decorador <code>@patch</code> de <code>fastcore.basics</code> nos permite fácilmente agregar funcionalidad a una clase ya definida.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L144" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="malla.agrega_puntos" class="level3">
<h3 class="anchored" data-anchor-id="malla.agrega_puntos">Malla.agrega_puntos</h3>
<blockquote class="blockquote">
<pre><code> Malla.agrega_puntos (puntos:geopandas.geodataframe.GeoDataFrame,
                      campo:str='cuenta', clasificacion:str=None,
                      pesos:str=None)</code></pre>
</blockquote>
<p>Regresa una <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#malla"><code>Malla</code></a> con los conteos de puntos en cada elemento.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>puntos</td>
<td>GeoDataFrame</td>
<td></td>
<td>La malla en la que se va a agregar</td>
</tr>
<tr class="even">
<td>campo</td>
<td>str</td>
<td>cuenta</td>
<td>Nombre del campo en el que se guarda el resultado</td>
</tr>
<tr class="odd">
<td>clasificacion</td>
<td>str</td>
<td>None</td>
<td>Columna de <code>puntos</code> que clasifica a las observaciones (ignora <code>campo</code>)</td>
</tr>
<tr class="even">
<td>pesos</td>
<td>str</td>
<td>None</td>
<td>Columna con pesos para las unidades</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Malla</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>La forma más sencilla de usar este método es simplemente agregar <em>todos</em> los puntos de una capa en la <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#malla"><code>Malla</code></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>pth <span class="op">=</span> descarga_denue(tipo<span class="op">=</span><span class="st">'ejemplo'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>puntos <span class="op">=</span> gpd.read_file(pth)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>agregado <span class="op">=</span> malla.agrega_puntos(puntos, campo<span class="op">=</span><span class="st">"puntos"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>agregado.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>El archivo ya está descargado</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>grid_id</th>
      <th>puntos</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 774927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 775927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 776927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 777927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 778927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>13745</th>
      <td>13745</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 894927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13746</th>
      <td>13746</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 895927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13747</th>
      <td>13747</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 896927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13748</th>
      <td>13748</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 897927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13749</th>
      <td>13749</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 898927.105, 2855631.810 ...</td>
    </tr>
  </tbody>
</table>
<p>13750 rows × 3 columns</p>
</div>
</div>
</div>
<p>La función regresa una copia del objeto original con el nuevo campo, el objeto original no se modifica:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>malla.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>grid_id</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>POLYGON ((2745631.810 774927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>POLYGON ((2745631.810 775927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>POLYGON ((2745631.810 776927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>POLYGON ((2745631.810 777927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>POLYGON ((2745631.810 778927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>13745</th>
      <td>13745</td>
      <td>POLYGON ((2854631.810 894927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13746</th>
      <td>13746</td>
      <td>POLYGON ((2854631.810 895927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13747</th>
      <td>13747</td>
      <td>POLYGON ((2854631.810 896927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13748</th>
      <td>13748</td>
      <td>POLYGON ((2854631.810 897927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13749</th>
      <td>13749</td>
      <td>POLYGON ((2854631.810 898927.105, 2855631.810 ...</td>
    </tr>
  </tbody>
</table>
<p>13750 rows × 2 columns</p>
</div>
</div>
</div>
<p>Podemos hacer un mapa de estos puntos agregados en la malla:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>agregado.datos.plot(<span class="st">'puntos'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-15-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>También es posible agregar los puntos de acuerdo a una clasificación previa. Por ejemplo, supongamos que tenemos datos del DENUE clasificados en tipos de usos de suelo como en el módulo <code>denue</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pth <span class="op">=</span> descarga_denue(tipo<span class="op">=</span><span class="st">'ejemplo'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>denue <span class="op">=</span> Denue.desde_archivo(pth)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>categorias <span class="op">=</span> {</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Manufacturas'</span>: [<span class="st">'^31.*5$'</span>, <span class="st">'^32.*5$'</span>, <span class="st">'^33.*5$'</span>],</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Oficinas'</span>: [<span class="st">'^51'</span>, <span class="st">'^521'</span>, <span class="st">'^523'</span>, <span class="st">'^524'</span>, <span class="st">'^5312'</span>, <span class="st">'^5313'</span>, <span class="st">'^541'</span>, <span class="st">'^55'</span>],</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Comercio'</span>: [<span class="st">'^46[123456]'</span>]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>usos <span class="op">=</span> denue.agrega_en_usos(categorias)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>usos.datos.loc[<span class="op">~</span>usos.datos.Categoria.isnull()][[<span class="st">'nom_estab'</span>, <span class="st">'codigo_act'</span>, <span class="st">'Categoria'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>El archivo ya está descargado</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>nom_estab</th>
      <th>codigo_act</th>
      <th>Categoria</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>TIENDA NATURISTA EL ARTE DE LA NATURALEZA</td>
      <td>464113</td>
      <td>Comercio</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SIN NOMBRE</td>
      <td>461130</td>
      <td>Comercio</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ADMINISTRACION MERCADO CONCENTRACION VOCEADORES</td>
      <td>531311</td>
      <td>Oficinas</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ABARROTES LA TIA</td>
      <td>461110</td>
      <td>Comercio</td>
    </tr>
    <tr>
      <th>7</th>
      <td>BIZUTERIA SIN NOMBRE</td>
      <td>463215</td>
      <td>Comercio</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Entonces podemos usar la columna <code>Categoria</code> para agregar los puntos en nuestra malla. La sintaxis es casi igual, sólo que en este caso pasamos el nombre de la columna con la que clasificamos las observaciones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>agregado <span class="op">=</span> malla.agrega_puntos(usos.datos, clasificacion<span class="op">=</span><span class="st">'Categoria'</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>agregado.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>grid_id</th>
      <th>Comercio</th>
      <th>Manufacturas</th>
      <th>Oficinas</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 774927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 775927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 776927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 777927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 778927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>13745</th>
      <td>13745</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 894927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13746</th>
      <td>13746</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 895927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13747</th>
      <td>13747</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 896927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13748</th>
      <td>13748</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 897927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13749</th>
      <td>13749</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 898927.105, 2855631.810 ...</td>
    </tr>
  </tbody>
</table>
<p>13750 rows × 5 columns</p>
</div>
</div>
</div>
<p>También podemos usar una columna con pesos para agregar los puntos. Por ejemplo, en el módulo <a href="https://CentroGeo.github.io/pyLandUseMX/api/denue.html#denue"><code>Denue</code></a> se pueden agregar pesos a las actividades económicas de acuerdo al número de empleados, podemos usar estos pesos para agregar esos datos en una malla.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>pesos <span class="op">=</span> {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">'0 a 5 personas'</span>: <span class="dv">2</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'6 a 10 personas'</span>: <span class="dv">8</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'11 a 30 personas'</span>: <span class="dv">20</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'31 a 50 personas'</span>: <span class="dv">40</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'51 a 100 personas'</span>: <span class="dv">75</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'101 a 250 personas'</span>: <span class="dv">175</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'251 y más personas'</span>: <span class="dv">300</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>usos_pesos <span class="op">=</span> usos.pesa_unidades(pesos)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>agregado_pesos <span class="op">=</span> malla.agrega_puntos(usos_pesos.datos, clasificacion<span class="op">=</span><span class="st">'Categoria'</span>, pesos<span class="op">=</span><span class="st">'pesos'</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>agregado_pesos.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>grid_id</th>
      <th>Comercio</th>
      <th>Manufacturas</th>
      <th>Oficinas</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 774927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 775927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 776927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 777927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 778927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>13745</th>
      <td>13745</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 894927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13746</th>
      <td>13746</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 895927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13747</th>
      <td>13747</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 896927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13748</th>
      <td>13748</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 897927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13749</th>
      <td>13749</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 898927.105, 2855631.810 ...</td>
    </tr>
  </tbody>
</table>
<p>13750 rows × 5 columns</p>
</div>
</div>
</div>
<p>Podemos comparar el resultado de usar o no los pesos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig, (ax0, ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ax0 <span class="op">=</span> agregado_pesos.datos.plot(<span class="st">'Oficinas'</span>, ax<span class="op">=</span>ax0)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ax0 <span class="op">=</span> ax0.set_title(<span class="st">"Con pesos"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> agregado.datos.plot(<span class="st">'Oficinas'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> ax1.set_title(<span class="st">"Sin pesos"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="sec-malla-lineas" class="level4">
<h4 class="anchored" data-anchor-id="sec-malla-lineas">Agrega líneas</h4>
<p>Ahora vamos a añadir la funcionalidad de agregar líneas en la malla. Lo que vamos a hacer es calcular la longitud de las líneas adentro de cada cuadrado de la retícula y utiliza ese valor en la malla. Sirve, por ejemplo, para calcular la longitud total de un tipo de vialidad en cada elemento de la malla.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L187" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="malla.agrega_lineas" class="level3">
<h3 class="anchored" data-anchor-id="malla.agrega_lineas">Malla.agrega_lineas</h3>
<blockquote class="blockquote">
<pre><code> Malla.agrega_lineas (lineas:geopandas.geodataframe.GeoDataFrame,
                      campo:str='longitud')</code></pre>
</blockquote>
<p>Regresa una <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#malla"><code>Malla</code></a> con la longitud de las lineas agregadas en cada elemento.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>lineas</td>
<td>GeoDataFrame</td>
<td></td>
<td>La capa de líneas a agregar</td>
</tr>
<tr class="even">
<td>campo</td>
<td>str</td>
<td>longitud</td>
<td>Nombre del campo en el que se guarda el resultado</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Malla</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Para probar la función, descargamos la red de OSM y filtramos sólo las vialidades primarias</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pth <span class="op">=</span> descarga_redes() <span class="co"># nos aseguramos de tener la red</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> gpd.read_file(pth)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> red.loc[red.tag_id.isin([<span class="dv">104</span>,<span class="dv">108</span>,<span class="dv">106</span>,<span class="dv">101</span>])]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>red.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>El archivo ya está descargado</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-21-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>Con esta capa podemos probar la función</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>red_malla <span class="op">=</span> malla.agrega_lineas(red, campo<span class="op">=</span><span class="st">'metros_vialidad'</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>red_malla.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>grid_id</th>
      <th>geometry</th>
      <th>metros_vialidad</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>POLYGON ((2745631.810 774927.105, 2746631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>POLYGON ((2745631.810 775927.105, 2746631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>POLYGON ((2745631.810 776927.105, 2746631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>POLYGON ((2745631.810 777927.105, 2746631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>POLYGON ((2745631.810 778927.105, 2746631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>13745</th>
      <td>13745</td>
      <td>POLYGON ((2854631.810 894927.105, 2855631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13746</th>
      <td>13746</td>
      <td>POLYGON ((2854631.810 895927.105, 2855631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13747</th>
      <td>13747</td>
      <td>POLYGON ((2854631.810 896927.105, 2855631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13748</th>
      <td>13748</td>
      <td>POLYGON ((2854631.810 897927.105, 2855631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13749</th>
      <td>13749</td>
      <td>POLYGON ((2854631.810 898927.105, 2855631.810 ...</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>13750 rows × 3 columns</p>
</div>
</div>
</div>
<p>La <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#malla"><code>Malla</code></a> que nos regresa sólo tiene el id de la malla y la longitud de la red dentro de cada elemento de la retícula. Lo podemos ver rápidamente en un mapa</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>red_malla.datos.plot(<span class="st">'metros_vialidad'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-23-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Como cada operación regresa una copia del objeto, podemos <em>encadenar</em> los métodos para ir agregando varias capas en una malla:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>malla_todo <span class="op">=</span> (malla</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>             .agrega_puntos(puntos, campo<span class="op">=</span><span class="st">"puntos"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>             .agrega_lineas(red, campo<span class="op">=</span><span class="st">'metros_vialidad'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>malla_todo.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>grid_id</th>
      <th>puntos</th>
      <th>geometry</th>
      <th>metros_vialidad</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 774927.105, 2746631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 775927.105, 2746631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 776927.105, 2746631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 777927.105, 2746631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>0.0</td>
      <td>POLYGON ((2745631.810 778927.105, 2746631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>13745</th>
      <td>13745</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 894927.105, 2855631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13746</th>
      <td>13746</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 895927.105, 2855631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13747</th>
      <td>13747</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 896927.105, 2855631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13748</th>
      <td>13748</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 897927.105, 2855631.810 ...</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13749</th>
      <td>13749</td>
      <td>0.0</td>
      <td>POLYGON ((2854631.810 898927.105, 2855631.810 ...</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>13750 rows × 4 columns</p>
</div>
</div>
</div>
<section id="sec-censo-mallas" class="level4">
<h4 class="anchored" data-anchor-id="sec-censo-mallas">Agrega variables del Censo</h4>
<p>Algunas variables importantes para analizar el uso de suelo vienen contenidas en los Censos de Ppoblación y Vivienda del INEGI. Como esta librería busca permitir al usuario la mayor libertad posible en cuanto a las unidades de análisis que escoja, optamos por desarrollar un método que permite partir de las variables censales a escala de manzana urbana y agregarlas en nuestras coberturas.</p>
<p>Agregar las manzanas en coberturas arbitrarioas (regulares o no) implica tener una relación entre los elementos de la cobertura y las manzanas, obviamente esto no se puede hacer de forma exacta porque las fronteras de las manzanas y los elementos de la malla no van a coincidir como se puede ver en la siguiente figura:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="malla_poligonos_1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Sobreposición de manzanas y una malla de 1000 metros</figcaption><p></p>
</figure>
</div>
<p>Para resolver este problema, la librería va a asignar automáticamente el id del elemento de la malla a todas las manzanas que estén completamente contenidas en un elemento. El problema va a estar cuando una manzana intersecta a más de un elemento de la malla, para estos casos tenemos dos soluciones alternativas:</p>
<ul>
<li>Centro de celda: se asigna el identificador del elemento de la malla en el que caiga el centro de la manzana</li>
<li>Área máxima: se asigna el identificador del elemento de la malla que contenga una mayor área de la manzana.</li>
</ul>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Estos métodos funcionan solo cuando el tamaño de la malla es, en general, más grande que las manzanas. Cuando la malla es más pequeña que las manzanas no arroja error pero los resultados no son confiables.</p>
</div>
</div>
<p>A partir de esta relación, entonces podemos seleccionar qué variables del Censo queremos agregar en nuestra retícula.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Por lo pronto la librería provee unicamente datos del censo a nivel manzana para la Zona Metropolitana del Valle de México, en el futuro cercano incluiremos las principales ciudades del país.</p>
</div>
</div>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L211" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="malla.agrega_manzanas" class="level3">
<h3 class="anchored" data-anchor-id="malla.agrega_manzanas">Malla.agrega_manzanas</h3>
<blockquote class="blockquote">
<pre><code> Malla.agrega_manzanas (manzanas:geopandas.geodataframe.GeoDataFrame,
                        variables:dict, metodo:str='centro')</code></pre>
</blockquote>
<p>Debe agregar variables del censo en la Soporte.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>manzanas</td>
<td>GeoDataFrame</td>
<td></td>
<td>Las manzanas (<code>descarga_manzanas_ejempolo</code>).</td>
</tr>
<tr class="even">
<td>variables</td>
<td>dict</td>
<td></td>
<td>Diccionario de las variables que querems agregar y el método para agregarlas (p, ej. {‘OCUPVIVPAR’:‘sum’})</td>
</tr>
<tr class="odd">
<td>metodo</td>
<td>str</td>
<td>centro</td>
<td>centro/area, método para resolver sobreposiciones</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Malla</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Vamos a ilustrar el funcionamiento de este método utilizando unos datos del censo a nivel manzana para la CDMX</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>pth <span class="op">=</span> descarga_manzanas_ejemplo()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>manzanas <span class="op">=</span> gpd.read_file(pth)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>manzanas.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>El archivo ya está descargado</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>CVEGEO</th>
      <th>VIVPAR_HAB</th>
      <th>OCUPVIVPAR</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0901000010898031</td>
      <td>22.0</td>
      <td>93.0</td>
      <td>POLYGON ((2790204.135 820779.247, 2790125.593 ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0901000012269024</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POLYGON ((2791387.916 821465.156, 2791376.215 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0901000011472068</td>
      <td>33.0</td>
      <td>124.0</td>
      <td>POLYGON ((2788494.355 822775.106, 2788478.422 ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0901000011824024</td>
      <td>95.0</td>
      <td>340.0</td>
      <td>POLYGON ((2790870.494 819456.298, 2790862.256 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0901000012377004</td>
      <td>23.0</td>
      <td>82.0</td>
      <td>POLYGON ((2792111.138 821977.886, 2792115.437 ...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Podemos agregar la variable <code>VIVPAR_HAB</code> usando la suma y <code>OCUPVIVPAR</code> con el promedio, utilizando el método <code>centro</code> para resolver las sobreposiciones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>malla_censo <span class="op">=</span> malla.agrega_manzanas(manzanas, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                                    {<span class="st">'VIVPAR_HAB'</span>: <span class="st">'sum'</span>, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'OCUPVIVPAR'</span>: <span class="st">'mean'</span>}, </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'centro'</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> malla_censo.datos.plot(<span class="st">'VIVPAR_HAB'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> ax1.set_title(<span class="st">"SUM VIVPAR_HAB"</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> malla_censo.datos.plot(<span class="st">'OCUPVIVPAR'</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax2.set_title(<span class="st">"MEAN OCUPVIVPAR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ahora podemos probar el método <code>area</code> y comparar los resultados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>malla_censo_area <span class="op">=</span> malla.agrega_manzanas(manzanas, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                                         {<span class="st">'VIVPAR_HAB'</span>: <span class="st">'sum'</span>, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'OCUPVIVPAR'</span>: <span class="st">'mean'</span>}, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'area'</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> malla_censo_area.datos.plot(<span class="st">'VIVPAR_HAB'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> ax1.set_title(<span class="st">"Método `area` VIVPAR_HAB"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> malla_censo.datos.plot(<span class="st">'VIVPAR_HAB'</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax2.set_title(<span class="st">"Método `centro` VIVPAR_HAB"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="malla-a-raster" class="level4">
<h4 class="anchored" data-anchor-id="malla-a-raster">Malla a raster</h4>
<p>Hasta ahora tenemos una representación vectorial de la malla, lo que sirve muy bien para operaciones espaciales con otras capas, pero una representación más natural y que nos permite operar de formas diferentes es la representación <em>raster</em>. En lugar de transformarlas en matrices directamente, vamos a usar <code>xarray</code> para representar nuestra malla como un <code>Dataset</code> de rasters.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L266" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="malla.to_xarray" class="level3">
<h3 class="anchored" data-anchor-id="malla.to_xarray">Malla.to_xarray</h3>
<blockquote class="blockquote">
<pre><code> Malla.to_xarray (campos:list=None)</code></pre>
</blockquote>
<p>Regresa un xarray con los <code>campos</code> seleccionados como variables.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>campos</td>
<td>list</td>
<td>None</td>
<td>Lista de campos a convertir, se convierten en bandas del raster</td>
</tr>
</tbody>
</table>
<p>La función sólo toma como entrada los campos que queremos transformar a raster y regresa un <code>xarray</code> con las variables que seleccionamos como <code>Data variables</code>, las coordenadas <code>x</code> y <code>y</code> como <code>Coordinates</code> y en la proyección de la malla que le pasemos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>cube <span class="op">=</span> malla_todo.to_xarray()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>cube</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.Dataset&gt;
Dimensions:          (y: 126, x: 111)
Coordinates:
  * y                (y) float64 7.745e+05 7.755e+05 ... 8.985e+05 8.995e+05
  * x                (x) float64 2.856e+06 2.854e+06 ... 2.746e+06 2.746e+06
    spatial_ref      int64 0
Data variables:
    puntos           (y, x) float64 nan nan nan nan nan ... 0.0 0.0 0.0 0.0 nan
    metros_vialidad  (y, x) float64 nan nan nan nan nan ... 0.0 0.0 0.0 0.0 nan</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.Dataset</div></div><ul class="xr-sections"><li class="xr-section-item"><input id="section-6acb79f1-0b4e-44ea-9f8a-c7554c0f3c31" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-6acb79f1-0b4e-44ea-9f8a-c7554c0f3c31" class="xr-section-summary" title="Expand/collapse section">Dimensions:</label><div class="xr-section-inline-details"><ul class="xr-dim-list"><li><span class="xr-has-index">y</span>: 126</li><li><span class="xr-has-index">x</span>: 111</li></ul></div><div class="xr-section-details"></div></li><li class="xr-section-item"><input id="section-85fda4b3-7e14-44d4-a2a1-fdcc95ed3de7" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-85fda4b3-7e14-44d4-a2a1-fdcc95ed3de7" class="xr-section-summary">Coordinates: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">7.745e+05 7.755e+05 ... 8.995e+05</div><input id="attrs-e97398fc-7692-4946-a9f1-111a9e56bf3c" class="xr-var-attrs-in" type="checkbox"><label for="attrs-e97398fc-7692-4946-a9f1-111a9e56bf3c" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-be5564c7-6c8b-4a29-b3e6-5e3eb0907f8c" class="xr-var-data-in" type="checkbox"><label for="data-be5564c7-6c8b-4a29-b3e6-5e3eb0907f8c" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>Y</dd><dt><span>long_name :</span></dt><dd>y coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_y_coordinate</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([774500., 775500., 776500., 777500., 778500., 779500., 780500., 781500.,
       782500., 783500., 784500., 785500., 786500., 787500., 788500., 789500.,
       790500., 791500., 792500., 793500., 794500., 795500., 796500., 797500.,
       798500., 799500., 800500., 801500., 802500., 803500., 804500., 805500.,
       806500., 807500., 808500., 809500., 810500., 811500., 812500., 813500.,
       814500., 815500., 816500., 817500., 818500., 819500., 820500., 821500.,
       822500., 823500., 824500., 825500., 826500., 827500., 828500., 829500.,
       830500., 831500., 832500., 833500., 834500., 835500., 836500., 837500.,
       838500., 839500., 840500., 841500., 842500., 843500., 844500., 845500.,
       846500., 847500., 848500., 849500., 850500., 851500., 852500., 853500.,
       854500., 855500., 856500., 857500., 858500., 859500., 860500., 861500.,
       862500., 863500., 864500., 865500., 866500., 867500., 868500., 869500.,
       870500., 871500., 872500., 873500., 874500., 875500., 876500., 877500.,
       878500., 879500., 880500., 881500., 882500., 883500., 884500., 885500.,
       886500., 887500., 888500., 889500., 890500., 891500., 892500., 893500.,
       894500., 895500., 896500., 897500., 898500., 899500.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">2.856e+06 2.854e+06 ... 2.746e+06</div><input id="attrs-e6d301d8-a7b4-4bca-ad09-c48db9a3689b" class="xr-var-attrs-in" type="checkbox"><label for="attrs-e6d301d8-a7b4-4bca-ad09-c48db9a3689b" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-199b576a-3c6a-49d9-86ad-958574ef24ea" class="xr-var-data-in" type="checkbox"><label for="data-199b576a-3c6a-49d9-86ad-958574ef24ea" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>X</dd><dt><span>long_name :</span></dt><dd>x coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_x_coordinate</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([2855500., 2854500., 2853500., 2852500., 2851500., 2850500., 2849500.,
       2848500., 2847500., 2846500., 2845500., 2844500., 2843500., 2842500.,
       2841500., 2840500., 2839500., 2838500., 2837500., 2836500., 2835500.,
       2834500., 2833500., 2832500., 2831500., 2830500., 2829500., 2828500.,
       2827500., 2826500., 2825500., 2824500., 2823500., 2822500., 2821500.,
       2820500., 2819500., 2818500., 2817500., 2816500., 2815500., 2814500.,
       2813500., 2812500., 2811500., 2810500., 2809500., 2808500., 2807500.,
       2806500., 2805500., 2804500., 2803500., 2802500., 2801500., 2800500.,
       2799500., 2798500., 2797500., 2796500., 2795500., 2794500., 2793500.,
       2792500., 2791500., 2790500., 2789500., 2788500., 2787500., 2786500.,
       2785500., 2784500., 2783500., 2782500., 2781500., 2780500., 2779500.,
       2778500., 2777500., 2776500., 2775500., 2774500., 2773500., 2772500.,
       2771500., 2770500., 2769500., 2768500., 2767500., 2766500., 2765500.,
       2764500., 2763500., 2762500., 2761500., 2760500., 2759500., 2758500.,
       2757500., 2756500., 2755500., 2754500., 2753500., 2752500., 2751500.,
       2750500., 2749500., 2748500., 2747500., 2746500., 2745500.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>spatial_ref</span></div><div class="xr-var-dims">()</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0</div><input id="attrs-b86ac775-e2a1-4329-8b11-9010f1b42405" class="xr-var-attrs-in" type="checkbox"><label for="attrs-b86ac775-e2a1-4329-8b11-9010f1b42405" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-1231fd58-c1bd-4a79-8769-915785280648" class="xr-var-data-in" type="checkbox"><label for="data-1231fd58-c1bd-4a79-8769-915785280648" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>crs_wkt :</span></dt><dd>PROJCS["International_Terrestrial_Reference_Frame_1992Lambert_Conformal_Conic_2SP",GEOGCS["GCS_International_Terrestrial_Reference_Frame_1992",DATUM["International_Terrestrial_Reference_Frame_1992",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6651"]],PRIMEM["Greenwich",0],UNIT["Degree",0.0174532925199433]],PROJECTION["Lambert_Conformal_Conic_2SP"],PARAMETER["false_easting",2500000],PARAMETER["false_northing",0],PARAMETER["central_meridian",-102],PARAMETER["standard_parallel_1",17.5],PARAMETER["standard_parallel_2",29.5],PARAMETER["Scale_Factor",1],PARAMETER["latitude_of_origin",12],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314140356</dd><dt><span>inverse_flattening :</span></dt><dd>298.257222101</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>GRS 1980</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>GCS_International_Terrestrial_Reference_Frame_1992</dd><dt><span>horizontal_datum_name :</span></dt><dd>International_Terrestrial_Reference_Frame_1992</dd><dt><span>projected_crs_name :</span></dt><dd>International_Terrestrial_Reference_Frame_1992Lambert_Conformal_Conic_2SP</dd><dt><span>grid_mapping_name :</span></dt><dd>lambert_conformal_conic</dd><dt><span>standard_parallel :</span></dt><dd>(17.5, 29.5)</dd><dt><span>latitude_of_projection_origin :</span></dt><dd>12.0</dd><dt><span>longitude_of_central_meridian :</span></dt><dd>-102.0</dd><dt><span>false_easting :</span></dt><dd>2500000.0</dd><dt><span>false_northing :</span></dt><dd>0.0</dd><dt><span>spatial_ref :</span></dt><dd>PROJCS["International_Terrestrial_Reference_Frame_1992Lambert_Conformal_Conic_2SP",GEOGCS["GCS_International_Terrestrial_Reference_Frame_1992",DATUM["International_Terrestrial_Reference_Frame_1992",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6651"]],PRIMEM["Greenwich",0],UNIT["Degree",0.0174532925199433]],PROJECTION["Lambert_Conformal_Conic_2SP"],PARAMETER["false_easting",2500000],PARAMETER["false_northing",0],PARAMETER["central_meridian",-102],PARAMETER["standard_parallel_1",17.5],PARAMETER["standard_parallel_2",29.5],PARAMETER["Scale_Factor",1],PARAMETER["latitude_of_origin",12],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]</dd><dt><span>GeoTransform :</span></dt><dd>2856000.0 -1000.0 0.0 774000.0 0.0 1000.0</dd></dl></div><div class="xr-var-data"><pre>array(0)</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-3bd44a1d-36ea-46d7-88d0-4339b7219b2f" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-3bd44a1d-36ea-46d7-88d0-4339b7219b2f" class="xr-section-summary">Data variables: <span>(2)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>puntos</span></div><div class="xr-var-dims">(y, x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">nan nan nan nan ... 0.0 0.0 0.0 nan</div><input id="attrs-eb0f3e3c-cca4-4189-9179-1cc0f44f1a00" class="xr-var-attrs-in" type="checkbox"><label for="attrs-eb0f3e3c-cca4-4189-9179-1cc0f44f1a00" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-81164af7-3c59-4a51-b65f-2a41d0e7aac2" class="xr-var-data-in" type="checkbox"><label for="data-81164af7-3c59-4a51-b65f-2a41d0e7aac2" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>name :</span></dt><dd>puntos</dd><dt><span>long_name :</span></dt><dd>puntos</dd><dt><span>_FillValue :</span></dt><dd>nan</dd></dl></div><div class="xr-var-data"><pre>array([[nan, nan, nan, ..., nan, nan, nan],
       [ 0.,  0.,  0., ...,  0.,  0., nan],
       [ 0.,  0.,  0., ...,  0.,  0., nan],
       ...,
       [ 0.,  0.,  0., ...,  0.,  0., nan],
       [ 0.,  0.,  0., ...,  0.,  0., nan],
       [ 0.,  0.,  0., ...,  0.,  0., nan]])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>metros_vialidad</span></div><div class="xr-var-dims">(y, x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">nan nan nan nan ... 0.0 0.0 0.0 nan</div><input id="attrs-c60ac0ff-1bc8-4c79-b4e3-a4ceb19bf657" class="xr-var-attrs-in" type="checkbox"><label for="attrs-c60ac0ff-1bc8-4c79-b4e3-a4ceb19bf657" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-5f66aa3a-a207-44a7-bf74-57066ab7a2d7" class="xr-var-data-in" type="checkbox"><label for="data-5f66aa3a-a207-44a7-bf74-57066ab7a2d7" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>name :</span></dt><dd>metros_vialidad</dd><dt><span>long_name :</span></dt><dd>metros_vialidad</dd><dt><span>_FillValue :</span></dt><dd>nan</dd></dl></div><div class="xr-var-data"><pre>array([[nan, nan, nan, ..., nan, nan, nan],
       [ 0.,  0.,  0., ...,  0.,  0., nan],
       [ 0.,  0.,  0., ...,  0.,  0., nan],
       ...,
       [ 0.,  0.,  0., ...,  0.,  0., nan],
       [ 0.,  0.,  0., ...,  0.,  0., nan],
       [ 0.,  0.,  0., ...,  0.,  0., nan]])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-632ec18e-fab3-42d4-afaa-2614c00da6f9" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-632ec18e-fab3-42d4-afaa-2614c00da6f9" class="xr-section-summary" title="Expand/collapse section">Attributes: <span>(0)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"></dl></div></li></ul></div></div>
</div>
</div>
<p>Podemos ver el raster correspondiente a cualquiera de las variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>cube.metros_vialidad.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.collections.QuadMesh&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-31-output-2.png" class="img-fluid"></p>
</div>
</div>
<section id="copiar-un-objeto" class="level4">
<h4 class="anchored" data-anchor-id="copiar-un-objeto">Copiar un objeto</h4>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L280" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="malla.copy" class="level3">
<h3 class="anchored" data-anchor-id="malla.copy">Malla.copy</h3>
<blockquote class="blockquote">
<pre><code> Malla.copy ()</code></pre>
</blockquote>
<p>Regresa una copia del objeto</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>malla_copia <span class="op">=</span> malla.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="polígonos" class="level3">
<h3 class="anchored" data-anchor-id="polígonos">Polígonos</h3>
<p>Además de calcular este tipo de agregaciones usando mallas regulares, también es importante poder usar unidades espaciales más <em>naturales</em> como por ejemplo Colonias. Para esto, la librería implementa la clase <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#poligonos"><code>Poligonos</code></a> que permite agregar los mismos tipos de datos que <code>Mallas</code> pero en Soportes construidas con polígonos de formas arbitrarias.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L286" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="poligonos" class="level3">
<h3 class="anchored" data-anchor-id="poligonos">Poligonos</h3>
<blockquote class="blockquote">
<pre><code> Poligonos (datos:geopandas.geodataframe.GeoDataFrame, id_col:str,
            nom_col:str=None)</code></pre>
</blockquote>
<p>Representa una cobertura de polígonos de forma arbitraria para procesar variables de uso de suelo.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>datos</td>
<td>GeoDataFrame</td>
<td></td>
<td>La malla vectorial</td>
</tr>
<tr class="even">
<td>id_col</td>
<td>str</td>
<td></td>
<td>Columna que se va a usar para identificar a cada polígono</td>
</tr>
<tr class="odd">
<td>nom_col</td>
<td>str</td>
<td>None</td>
<td>Columna con el nombre de las unidades espaciales</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L300" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="poligonos.desde_archivo" class="level3">
<h3 class="anchored" data-anchor-id="poligonos.desde_archivo">Poligonos.desde_archivo</h3>
<blockquote class="blockquote">
<pre><code> Poligonos.desde_archivo (path:str, id_col:str, nom_col:str=None,
                          layer=None)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>path</td>
<td>str</td>
<td></td>
<td>Path al archivo de datos (cualquiera soportado por GeoPandas),</td>
</tr>
<tr class="even">
<td>id_col</td>
<td>str</td>
<td></td>
<td>Columna que se va a usar para identificar a cada polígono</td>
</tr>
<tr class="odd">
<td>nom_col</td>
<td>str</td>
<td>None</td>
<td>Columna con el nombre de las unidades espaciales</td>
</tr>
<tr class="even">
<td>layer</td>
<td>NoneType</td>
<td>None</td>
<td>Nombre del <em>layer</em> dentro de la fuente de datos.</td>
</tr>
</tbody>
</table>
<p>La clase contiene un método para construirla a partir de un archivo (en cualquier formato soportado por Geopandas). Para construir un objeto de esta forma, simplemente le pasamos el path al método y especificamos qué columna deberemos usar como identificador de las unidades espaciales. Si queremos que las unidades conserven un nombre (además del identificador), lo podemos pasar al constructor:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>pth <span class="op">=</span> descarga_colonias_cdmx()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>poligonos <span class="op">=</span> Poligonos.desde_archivo(pth, <span class="st">'id'</span>, nom_col<span class="op">=</span><span class="st">'nomut'</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>poligonos.datos.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>nomut</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>AGUILERA</td>
      <td>POLYGON ((483311.618 2153254.848, 483332.006 2...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>ALDANA</td>
      <td>POLYGON ((484406.956 2153012.331, 484401.132 2...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ANGEL ZIMBRON</td>
      <td>POLYGON ((480013.755 2153003.618, 480063.589 2...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>ARENAL</td>
      <td>POLYGON ((484061.118 2152622.284, 484061.678 2...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>CENTRO DE AZCAPOTZALCO</td>
      <td>POLYGON ((480123.402 2154520.928, 480131.648 2...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="transformación-de-coordenadas-1" class="level4">
<h4 class="anchored" data-anchor-id="transformación-de-coordenadas-1">Transformación de coordenadas</h4>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L326" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="poligonos.to_crs" class="level3">
<h3 class="anchored" data-anchor-id="poligonos.to_crs">Poligonos.to_crs</h3>
<blockquote class="blockquote">
<pre><code> Poligonos.to_crs (to_crs:Union[int,str,pyproj.crs.crs.CRS])</code></pre>
</blockquote>
<p>Se encarga de transformar de coordenadas.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>to_crs</td>
<td>Union</td>
<td>El crs al que queremos reproyectar</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Malla</strong></td>
<td></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>poligonos_4326 <span class="op">=</span> poligonos.to_crs(<span class="dv">4326</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poligonos_4326.crs, poligonos.crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>epsg:4326 epsg:32614</code></pre>
</div>
</div>
<section id="agrega-puntos" class="level4">
<h4 class="anchored" data-anchor-id="agrega-puntos">Agrega puntos</h4>
<p>Igual que con las mallas, tenemos un método para contar puntos adentro de cada unidad.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L335" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="poligonos.agrega_puntos" class="level3">
<h3 class="anchored" data-anchor-id="poligonos.agrega_puntos">Poligonos.agrega_puntos</h3>
<blockquote class="blockquote">
<pre><code> Poligonos.agrega_puntos (puntos:geopandas.geodataframe.GeoDataFrame,
                          campo:str='cuenta', clasificacion:str=None,
                          pesos:str=None)</code></pre>
</blockquote>
<p>Regresa un <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#poligonos"><code>Poligonos</code></a> con los conteos de puntos en cada unidad.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>puntos</td>
<td>GeoDataFrame</td>
<td></td>
<td>La malla en la que se va a agregar</td>
</tr>
<tr class="even">
<td>campo</td>
<td>str</td>
<td>cuenta</td>
<td>Nombre del campo en el que se guarda el resultado</td>
</tr>
<tr class="odd">
<td>clasificacion</td>
<td>str</td>
<td>None</td>
<td>Columna de <code>puntos</code> que clasifica a las observaciones. En este caso se agregan</td>
</tr>
<tr class="even">
<td>pesos</td>
<td>str</td>
<td>None</td>
<td>Columna con pesos para las unidades</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Poligonos</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>La forma más sencilla de usar este método es simplemente agregar <em>todos</em> los puntos de una capa en nuestros polígonos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>puntos <span class="op">=</span> gpd.read_file(<span class="st">"../../datos/points_sample.zip"</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>agregado <span class="op">=</span> poligonos.agrega_puntos(puntos, campo<span class="op">=</span><span class="st">"puntos"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>agregado.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>puntos</th>
      <th>nomut</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0.0</td>
      <td>AGUILERA</td>
      <td>POLYGON ((483311.618 2153254.848, 483332.006 2...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>0.0</td>
      <td>ALDANA</td>
      <td>POLYGON ((484406.956 2153012.331, 484401.132 2...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>0.0</td>
      <td>ANGEL ZIMBRON</td>
      <td>POLYGON ((480013.755 2153003.618, 480063.589 2...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0.0</td>
      <td>ARENAL</td>
      <td>POLYGON ((484061.118 2152622.284, 484061.678 2...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1.0</td>
      <td>CENTRO DE AZCAPOTZALCO</td>
      <td>POLYGON ((480123.402 2154520.928, 480131.648 2...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1810</th>
      <td>1811</td>
      <td>0.0</td>
      <td>VILLA PROGRESISTA</td>
      <td>POLYGON ((474406.945 2140353.439, 474418.850 2...</td>
    </tr>
    <tr>
      <th>1811</th>
      <td>1812</td>
      <td>0.0</td>
      <td>VILLA SOLIDARIDAD</td>
      <td>POLYGON ((477048.978 2143204.554, 477054.695 2...</td>
    </tr>
    <tr>
      <th>1812</th>
      <td>1813</td>
      <td>0.0</td>
      <td>VILLA VERDUN</td>
      <td>POLYGON ((473081.154 2138733.281, 473070.790 2...</td>
    </tr>
    <tr>
      <th>1813</th>
      <td>1814</td>
      <td>0.0</td>
      <td>ZENON DELGADO</td>
      <td>POLYGON ((477329.014 2144260.214, 477335.725 2...</td>
    </tr>
    <tr>
      <th>1814</th>
      <td>1815</td>
      <td>0.0</td>
      <td>ZOTOLTITLA</td>
      <td>POLYGON ((475172.282 2139719.331, 475190.495 2...</td>
    </tr>
  </tbody>
</table>
<p>1815 rows × 4 columns</p>
</div>
</div>
</div>
<p>También, como en el caso de las mallas, podemos usar una columna con la clasificación para agregar los usos en los polígonos. Usando la misma clasificación que usamos arriba:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>agregado <span class="op">=</span> poligonos.agrega_puntos(usos.datos, clasificacion<span class="op">=</span><span class="st">'Categoria'</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>agregado.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>Comercio</th>
      <th>Manufacturas</th>
      <th>Oficinas</th>
      <th>nomut</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>AGUILERA</td>
      <td>POLYGON ((483311.618 2153254.848, 483332.006 2...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>ALDANA</td>
      <td>POLYGON ((484406.956 2153012.331, 484401.132 2...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>ANGEL ZIMBRON</td>
      <td>POLYGON ((480013.755 2153003.618, 480063.589 2...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>9.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>ARENAL</td>
      <td>POLYGON ((484061.118 2152622.284, 484061.678 2...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>43.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>CENTRO DE AZCAPOTZALCO</td>
      <td>POLYGON ((480123.402 2154520.928, 480131.648 2...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1810</th>
      <td>1811</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>VILLA PROGRESISTA</td>
      <td>POLYGON ((474406.945 2140353.439, 474418.850 2...</td>
    </tr>
    <tr>
      <th>1811</th>
      <td>1812</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>VILLA SOLIDARIDAD</td>
      <td>POLYGON ((477048.978 2143204.554, 477054.695 2...</td>
    </tr>
    <tr>
      <th>1812</th>
      <td>1813</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>VILLA VERDUN</td>
      <td>POLYGON ((473081.154 2138733.281, 473070.790 2...</td>
    </tr>
    <tr>
      <th>1813</th>
      <td>1814</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>ZENON DELGADO</td>
      <td>POLYGON ((477329.014 2144260.214, 477335.725 2...</td>
    </tr>
    <tr>
      <th>1814</th>
      <td>1815</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>ZOTOLTITLA</td>
      <td>POLYGON ((475172.282 2139719.331, 475190.495 2...</td>
    </tr>
  </tbody>
</table>
<p>1815 rows × 6 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>agregado.datos.plot(<span class="st">'Comercio'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-42-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>También podemos usar una clolumna con pesos para agregar los puntos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>agregado_pesos <span class="op">=</span> poligonos.agrega_puntos(usos_pesos.datos, clasificacion<span class="op">=</span><span class="st">'Categoria'</span>, pesos<span class="op">=</span><span class="st">'pesos'</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>agregado_pesos.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>Comercio</th>
      <th>Manufacturas</th>
      <th>Oficinas</th>
      <th>nomut</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>22.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>AGUILERA</td>
      <td>POLYGON ((483311.618 2153254.848, 483332.006 2...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>ALDANA</td>
      <td>POLYGON ((484406.956 2153012.331, 484401.132 2...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>ANGEL ZIMBRON</td>
      <td>POLYGON ((480013.755 2153003.618, 480063.589 2...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>36.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>ARENAL</td>
      <td>POLYGON ((484061.118 2152622.284, 484061.678 2...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>140.0</td>
      <td>0.0</td>
      <td>64.0</td>
      <td>CENTRO DE AZCAPOTZALCO</td>
      <td>POLYGON ((480123.402 2154520.928, 480131.648 2...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1810</th>
      <td>1811</td>
      <td>10.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>VILLA PROGRESISTA</td>
      <td>POLYGON ((474406.945 2140353.439, 474418.850 2...</td>
    </tr>
    <tr>
      <th>1811</th>
      <td>1812</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>VILLA SOLIDARIDAD</td>
      <td>POLYGON ((477048.978 2143204.554, 477054.695 2...</td>
    </tr>
    <tr>
      <th>1812</th>
      <td>1813</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>VILLA VERDUN</td>
      <td>POLYGON ((473081.154 2138733.281, 473070.790 2...</td>
    </tr>
    <tr>
      <th>1813</th>
      <td>1814</td>
      <td>8.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>ZENON DELGADO</td>
      <td>POLYGON ((477329.014 2144260.214, 477335.725 2...</td>
    </tr>
    <tr>
      <th>1814</th>
      <td>1815</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>ZOTOLTITLA</td>
      <td>POLYGON ((475172.282 2139719.331, 475190.495 2...</td>
    </tr>
  </tbody>
</table>
<p>1815 rows × 6 columns</p>
</div>
</div>
</div>
<p>Veamos la comparación de usar o no usar los pesos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fig, (ax0, ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>ax0 <span class="op">=</span> agregado_pesos.datos.plot(<span class="st">'Oficinas'</span>, ax<span class="op">=</span>ax0)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>ax0 <span class="op">=</span> ax0.set_title(<span class="st">"Con pesos"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> agregado.datos.plot(<span class="st">'Oficinas'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> ax1.set_title(<span class="st">"Sin pesos"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="agrega-líneas" class="level4">
<h4 class="anchored" data-anchor-id="agrega-líneas">Agrega líneas</h4>
<p>Igual que para el caso de <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#malla"><code>Malla</code></a>, la clase permite agregar líneas en los polígonos, es decir, calcular la cantidad de metros de una capa de líneas que hay adentro de cada elemento de la cobertura de polígonos. En el caso de los polígonos, al ser de forma irregular, tiene sentido calcular la longitud <em>por unidad de área</em>, en lugar de solo la longitud, el método permite ambas cosas, pero el default es calcular por unidad de área</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L383" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="poligonos.agrega_lineas" class="level3">
<h3 class="anchored" data-anchor-id="poligonos.agrega_lineas">Poligonos.agrega_lineas</h3>
<blockquote class="blockquote">
<pre><code> Poligonos.agrega_lineas (lineas:geopandas.geodataframe.GeoDataFrame,
                          campo:str='longitud', proporcion:bool=True)</code></pre>
</blockquote>
<p>Regresa un <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#poligonos"><code>Poligonos</code></a> con la longitud de las lineas agregadas en cada elemento.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>lineas</td>
<td>GeoDataFrame</td>
<td></td>
<td>La capa de líneas a agregar</td>
</tr>
<tr class="even">
<td>campo</td>
<td>str</td>
<td>longitud</td>
<td>Nombre del campo en el que se guarda el resultado</td>
</tr>
<tr class="odd">
<td>proporcion</td>
<td>bool</td>
<td>True</td>
<td>¿Debemos hacer el cálculo por unidad de área?</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Malla</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Podemos probar esta función con la misma red que usamos en <a href="#sec-malla-lineas">Section&nbsp;1.7.1</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>poligonos_red <span class="op">=</span> poligonos.agrega_lineas(red)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> poligonos_red.datos.plot(<span class="st">'longitud'</span>, legend<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-46-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="agrega-variables-del-censo" class="level4">
<h4 class="anchored" data-anchor-id="agrega-variables-del-censo">Agrega variables del censo</h4>
<p>Igual que en el caso de las mallas regulares (<a href="#sec-censo-mallas">Section&nbsp;1.8.1</a>), es necesario contar con métodos para agregar variables censales en unidades irregulares. Los problemas en este caso son exáctamente los mismos que los que se enfrentan en ese caso y la solución que ofrece la librería es muy similar, en este caso sólo implementamos el método del centro para resolver las sobreposiciones.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L412" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="poligonos.agrega_manzanas" class="level3">
<h3 class="anchored" data-anchor-id="poligonos.agrega_manzanas">Poligonos.agrega_manzanas</h3>
<blockquote class="blockquote">
<pre><code> Poligonos.agrega_manzanas (manzanas:geopandas.geodataframe.GeoDataFrame,
                            variables:dict)</code></pre>
</blockquote>
<p>Debe agregar variables del censo en la Soporte.</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>manzanas</td>
<td>GeoDataFrame</td>
<td>Las manzanas (<code>descarga_manzanas_ejempolo</code>).</td>
</tr>
<tr class="even">
<td>variables</td>
<td>dict</td>
<td>Diccionario de las variables que querems agregar y el método para agregarlas (p, ej. {‘OCUPVIVPAR’:‘sum’})</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Poligonos</strong></td>
<td></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>agregado_censo <span class="op">=</span> poligonos.agrega_manzanas(manzanas, {<span class="st">'VIVPAR_HAB'</span>: <span class="st">'sum'</span>, </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">'OCUPVIVPAR'</span>: <span class="st">'mean'</span>})</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> agregado_censo.datos.plot(<span class="st">'VIVPAR_HAB'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> ax1.set_title(<span class="st">"SUM VIVPAR_HAB"</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> agregado_censo.datos.plot(<span class="st">'OCUPVIVPAR'</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax2.set_title(<span class="st">"MEAN OCUPVIVPAR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="copiar-un-objeto-1" class="level4">
<h4 class="anchored" data-anchor-id="copiar-un-objeto-1">Copiar un objeto</h4>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L432" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="poligonos.copy" class="level3">
<h3 class="anchored" data-anchor-id="poligonos.copy">Poligonos.copy</h3>
<blockquote class="blockquote">
<pre><code> Poligonos.copy ()</code></pre>
</blockquote>
<p>Regresa una copia del objeto</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>poligonos.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;__main__.Poligonos&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="usodesuelo" class="level2">
<h2 class="anchored" data-anchor-id="usodesuelo">UsoDeSuelo</h2>
<p>La clase de suelo parte de un soporte espacial y la definiión de un conjunto de variables de uso de suelo y del medio construido para construir una <em>capa</em> que nos permite calcular diferentes índices y representarlos en maás y gráficas.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L440" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="usodesuelo-1" class="level3">
<h3 class="anchored" data-anchor-id="usodesuelo-1">UsoDeSuelo</h3>
<blockquote class="blockquote">
<pre><code> UsoDeSuelo (soporte:__main__.Soporte, vars_uso:Optional[List[int]]=None,
             vars_mc:Optional[List[int]]=None)</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>soporte</td>
<td>Soporte</td>
<td></td>
<td>El soporte espacial de la capa</td>
</tr>
<tr class="even">
<td>vars_uso</td>
<td>Optional</td>
<td>None</td>
<td>Nombres de las columnas del soporte con variables de uso de suelo</td>
</tr>
<tr class="odd">
<td>vars_mc</td>
<td>Optional</td>
<td>None</td>
<td>Nombres de las columnas del soporte con variables del medio construido</td>
</tr>
</tbody>
</table>
<p>Podemos crear una capa de <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#usodesuelo"><code>UsoDeSuelo</code></a> partiendo únicamente de un <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#soporte"><code>Soporte</code></a> sin ninguna otra variable. Por ejemplo, partiendo de una <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#malla"><code>Malla</code></a></p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si el <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#soporte"><code>Soporte</code></a> que se usa tiene ya variables calculadas, pero no se especifican como <code>vars_uso</code> o <code>vars_mc</code> estas variables se eliminan de los datos.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>uso_malla <span class="op">=</span> UsoDeSuelo(malla)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>uso_malla.vars_mc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>uso_malla.soporte.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>grid_id</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>POLYGON ((2745631.810 774927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>POLYGON ((2745631.810 775927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>POLYGON ((2745631.810 776927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>POLYGON ((2745631.810 777927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>POLYGON ((2745631.810 778927.105, 2746631.810 ...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>13745</th>
      <td>13745</td>
      <td>POLYGON ((2854631.810 894927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13746</th>
      <td>13746</td>
      <td>POLYGON ((2854631.810 895927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13747</th>
      <td>13747</td>
      <td>POLYGON ((2854631.810 896927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13748</th>
      <td>13748</td>
      <td>POLYGON ((2854631.810 897927.105, 2855631.810 ...</td>
    </tr>
    <tr>
      <th>13749</th>
      <td>13749</td>
      <td>POLYGON ((2854631.810 898927.105, 2855631.810 ...</td>
    </tr>
  </tbody>
</table>
<p>13750 rows × 2 columns</p>
</div>
</div>
</div>
<p>Lo mismo podemos hacer a partir de un objeto de la clase <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#poligonos"><code>Poligonos</code></a>. En este caso, si el objeto contiene la propiedad <code>nom_col</code>, esta columna se conserva.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>uso_poligonos <span class="op">=</span> UsoDeSuelo(poligonos)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>uso_poligonos.soporte.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>nomut</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>AGUILERA</td>
      <td>POLYGON ((483311.618 2153254.848, 483332.006 2...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>ALDANA</td>
      <td>POLYGON ((484406.956 2153012.331, 484401.132 2...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ANGEL ZIMBRON</td>
      <td>POLYGON ((480013.755 2153003.618, 480063.589 2...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>ARENAL</td>
      <td>POLYGON ((484061.118 2152622.284, 484061.678 2...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>CENTRO DE AZCAPOTZALCO</td>
      <td>POLYGON ((480123.402 2154520.928, 480131.648 2...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1810</th>
      <td>1811</td>
      <td>VILLA PROGRESISTA</td>
      <td>POLYGON ((474406.945 2140353.439, 474418.850 2...</td>
    </tr>
    <tr>
      <th>1811</th>
      <td>1812</td>
      <td>VILLA SOLIDARIDAD</td>
      <td>POLYGON ((477048.978 2143204.554, 477054.695 2...</td>
    </tr>
    <tr>
      <th>1812</th>
      <td>1813</td>
      <td>VILLA VERDUN</td>
      <td>POLYGON ((473081.154 2138733.281, 473070.790 2...</td>
    </tr>
    <tr>
      <th>1813</th>
      <td>1814</td>
      <td>ZENON DELGADO</td>
      <td>POLYGON ((477329.014 2144260.214, 477335.725 2...</td>
    </tr>
    <tr>
      <th>1814</th>
      <td>1815</td>
      <td>ZOTOLTITLA</td>
      <td>POLYGON ((475172.282 2139719.331, 475190.495 2...</td>
    </tr>
  </tbody>
</table>
<p>1815 rows × 3 columns</p>
</div>
</div>
</div>
<p>También podemos partir de un <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#soporte"><code>Soporte</code></a> que ya tenga algunas variables claculadas y usarlas en nuestro objeto. Por ejemplo, para crear una capa de UsoDeSuelo con los datos que calculamos en <span class="citation" data-cites="secc-malla-puntos">@secc-malla-puntos</span> solo tenemos que especificar cómo queremos usar las variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>uso_vars_malla <span class="op">=</span> UsoDeSuelo(agregado, vars_uso<span class="op">=</span>[<span class="st">'Comercio'</span>, <span class="st">'Manufacturas'</span>, <span class="st">'Oficinas'</span>])</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>uso_vars_malla.soporte.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>geometry</th>
      <th>Comercio</th>
      <th>Manufacturas</th>
      <th>Oficinas</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>POLYGON ((483311.618 2153254.848, 483332.006 2...</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>POLYGON ((484406.956 2153012.331, 484401.132 2...</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>POLYGON ((480013.755 2153003.618, 480063.589 2...</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>POLYGON ((484061.118 2152622.284, 484061.678 2...</td>
      <td>9.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>POLYGON ((480123.402 2154520.928, 480131.648 2...</td>
      <td>43.0</td>
      <td>0.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1810</th>
      <td>1811</td>
      <td>POLYGON ((474406.945 2140353.439, 474418.850 2...</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1811</th>
      <td>1812</td>
      <td>POLYGON ((477048.978 2143204.554, 477054.695 2...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1812</th>
      <td>1813</td>
      <td>POLYGON ((473081.154 2138733.281, 473070.790 2...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1813</th>
      <td>1814</td>
      <td>POLYGON ((477329.014 2144260.214, 477335.725 2...</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1814</th>
      <td>1815</td>
      <td>POLYGON ((475172.282 2139719.331, 475190.495 2...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>1815 rows × 5 columns</p>
</div>
</div>
</div>
<p>Y las variables quedan agregadas en la lista en la que deben</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>uso_vars_malla.vars_uso</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['Comercio', 'Manufacturas', 'Oficinas']</code></pre>
</div>
</div>
<p>Si no le decimos que queremos usar esas columnas, las elimina.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>uso_malla <span class="op">=</span> UsoDeSuelo(agregado)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>uso_malla.soporte.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>POLYGON ((483311.618 2153254.848, 483332.006 2...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>POLYGON ((484406.956 2153012.331, 484401.132 2...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>POLYGON ((480013.755 2153003.618, 480063.589 2...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>POLYGON ((484061.118 2152622.284, 484061.678 2...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>POLYGON ((480123.402 2154520.928, 480131.648 2...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1810</th>
      <td>1811</td>
      <td>POLYGON ((474406.945 2140353.439, 474418.850 2...</td>
    </tr>
    <tr>
      <th>1811</th>
      <td>1812</td>
      <td>POLYGON ((477048.978 2143204.554, 477054.695 2...</td>
    </tr>
    <tr>
      <th>1812</th>
      <td>1813</td>
      <td>POLYGON ((473081.154 2138733.281, 473070.790 2...</td>
    </tr>
    <tr>
      <th>1813</th>
      <td>1814</td>
      <td>POLYGON ((477329.014 2144260.214, 477335.725 2...</td>
    </tr>
    <tr>
      <th>1814</th>
      <td>1815</td>
      <td>POLYGON ((475172.282 2139719.331, 475190.495 2...</td>
    </tr>
  </tbody>
</table>
<p>1815 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="agrega-puntos-1" class="level3">
<h3 class="anchored" data-anchor-id="agrega-puntos-1">Agrega puntos</h3>
<p>La clase <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#usodesuelo"><code>UsoDeSuelo</code></a> permite hacer las mismas agregaciones que las clases <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#malla"><code>Malla</code></a> y <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#poligonos"><code>Poligonos</code></a>, solo recibe un parámetro extra que le indica si son variables de uso de suelo o del medio construido.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L483" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="usodesuelo.agrega_puntos" class="level3">
<h3 class="anchored" data-anchor-id="usodesuelo.agrega_puntos">UsoDeSuelo.agrega_puntos</h3>
<blockquote class="blockquote">
<pre><code> UsoDeSuelo.agrega_puntos (puntos:geopandas.geodataframe.GeoDataFrame,
                           campo:str='cuenta', clasificacion:str=None,
                           pesos:str=None, tipo_var:str='uso')</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>puntos</td>
<td>GeoDataFrame</td>
<td></td>
<td>La malla en la que se va a agregar</td>
</tr>
<tr class="even">
<td>campo</td>
<td>str</td>
<td>cuenta</td>
<td>Nombre del campo en el que se guarda el resultado</td>
</tr>
<tr class="odd">
<td>clasificacion</td>
<td>str</td>
<td>None</td>
<td>Columna de <code>puntos</code> que clasifica a las observaciones (ignora <code>campo</code>)</td>
</tr>
<tr class="even">
<td>pesos</td>
<td>str</td>
<td>None</td>
<td>Columna con pesos para las unidades</td>
</tr>
<tr class="odd">
<td>tipo_var</td>
<td>str</td>
<td>uso</td>
<td>uso/mc ¿qué tipo de variable estamos agregando</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>UsoDeSuelo</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Agregar puntos a una capa de UsoDeSuelo funciona de la misma forma que en el caso de <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#soporte"><code>Soporte</code></a>, por ejemplo, partiendo de una capa vacía, podemos agregar los puntos del Denue con categorías de uso de suelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>usos_malla <span class="op">=</span> UsoDeSuelo(malla)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>usos_malla <span class="op">=</span> usos_malla.agrega_puntos(usos.datos, clasificacion<span class="op">=</span><span class="st">'Categoria'</span>, tipo_var<span class="op">=</span><span class="st">'uso'</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>usos_malla.vars_uso</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['Comercio', 'Oficinas', 'Manufacturas']</code></pre>
</div>
</div>
<p>Podemos hacer axactamente lo mismo partiendo de un soporte de <a href="https://CentroGeo.github.io/pyLandUseMX/api/usodesuelo.html#poligonos"><code>Poligonos</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>uso_vars_poli <span class="op">=</span> UsoDeSuelo(agregado)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>uso_vars_poli <span class="op">=</span> uso_vars_poli.agrega_puntos(usos.datos, clasificacion<span class="op">=</span><span class="st">'Categoria'</span>, tipo_var<span class="op">=</span><span class="st">'uso'</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>uso_vars_poli.soporte.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>geometry</th>
      <th>Comercio</th>
      <th>Oficinas</th>
      <th>Manufacturas</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>POLYGON ((483311.618 2153254.848, 483332.006 2...</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>POLYGON ((484406.956 2153012.331, 484401.132 2...</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>POLYGON ((480013.755 2153003.618, 480063.589 2...</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>POLYGON ((484061.118 2152622.284, 484061.678 2...</td>
      <td>9.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>POLYGON ((480123.402 2154520.928, 480131.648 2...</td>
      <td>43.0</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1810</th>
      <td>1811</td>
      <td>POLYGON ((474406.945 2140353.439, 474418.850 2...</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1811</th>
      <td>1812</td>
      <td>POLYGON ((477048.978 2143204.554, 477054.695 2...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1812</th>
      <td>1813</td>
      <td>POLYGON ((473081.154 2138733.281, 473070.790 2...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1813</th>
      <td>1814</td>
      <td>POLYGON ((477329.014 2144260.214, 477335.725 2...</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1814</th>
      <td>1815</td>
      <td>POLYGON ((475172.282 2139719.331, 475190.495 2...</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1815 rows × 5 columns</p>
</div>
</div>
</div>
<p>En este caso tenemos las siguientes variables de uso de suelo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>uso_vars_poli.vars_uso</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['Comercio', 'Oficinas', 'Manufacturas']</code></pre>
</div>
</div>
</section>
<section id="agregar-líneas" class="level3">
<h3 class="anchored" data-anchor-id="agregar-líneas">Agregar líneas</h3>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L510" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="usodesuelo.agrega_lineas" class="level3">
<h3 class="anchored" data-anchor-id="usodesuelo.agrega_lineas">UsoDeSuelo.agrega_lineas</h3>
<blockquote class="blockquote">
<pre><code> UsoDeSuelo.agrega_lineas (lineas:geopandas.geodataframe.GeoDataFrame,
                           campo:str='longitud', tipo_var:str='uso')</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>lineas</td>
<td>GeoDataFrame</td>
<td></td>
<td>La capa de líneas a agregar</td>
</tr>
<tr class="even">
<td>campo</td>
<td>str</td>
<td>longitud</td>
<td>Nombre del campo en el que se guarda el resultado</td>
</tr>
<tr class="odd">
<td>tipo_var</td>
<td>str</td>
<td>uso</td>
<td>uso/mc ¿qué tipo de variable estamos agregando</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>UsoDeSuelo</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Partiendo de la capa que acabamos de calcular con las variables de uso de suelo agregadas en una malla, podemos agregar ahora la red vial en las variables de medio construido</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>usos_malla <span class="op">=</span> usos_malla.agrega_lineas(red, campo<span class="op">=</span><span class="st">'metros_vialidad'</span>, tipo_var<span class="op">=</span><span class="st">'mc'</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>usos_malla.soporte.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>grid_id</th>
      <th>geometry</th>
      <th>Comercio</th>
      <th>Oficinas</th>
      <th>Manufacturas</th>
      <th>metros_vialidad</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>POLYGON ((2745631.810 774927.105, 2746631.810 ...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>POLYGON ((2745631.810 775927.105, 2746631.810 ...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>POLYGON ((2745631.810 776927.105, 2746631.810 ...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>POLYGON ((2745631.810 777927.105, 2746631.810 ...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>POLYGON ((2745631.810 778927.105, 2746631.810 ...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>13745</th>
      <td>13745</td>
      <td>POLYGON ((2854631.810 894927.105, 2855631.810 ...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13746</th>
      <td>13746</td>
      <td>POLYGON ((2854631.810 895927.105, 2855631.810 ...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13747</th>
      <td>13747</td>
      <td>POLYGON ((2854631.810 896927.105, 2855631.810 ...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13748</th>
      <td>13748</td>
      <td>POLYGON ((2854631.810 897927.105, 2855631.810 ...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13749</th>
      <td>13749</td>
      <td>POLYGON ((2854631.810 898927.105, 2855631.810 ...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>13750 rows × 6 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(usos_malla.vars_uso, usos_malla.vars_mc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Comercio', 'Oficinas', 'Manufacturas'] ['metros_vialidad']</code></pre>
</div>
</div>
<p>Partiendo ahora de la capa con soporte en polígonos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>uso_vars_poli <span class="op">=</span> uso_vars_poli.agrega_lineas(red, campo<span class="op">=</span><span class="st">'metros_vialidad'</span>, tipo_var<span class="op">=</span><span class="st">'mc'</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>uso_vars_poli.soporte.datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>geometry</th>
      <th>Comercio</th>
      <th>Oficinas</th>
      <th>Manufacturas</th>
      <th>metros_vialidad</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>POLYGON ((483311.618 2153254.848, 483332.006 2...</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.008404</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>POLYGON ((484406.956 2153012.331, 484401.132 2...</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.001232</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>POLYGON ((480013.755 2153003.618, 480063.589 2...</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.015416</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>POLYGON ((484061.118 2152622.284, 484061.678 2...</td>
      <td>9.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005071</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>POLYGON ((480123.402 2154520.928, 480131.648 2...</td>
      <td>43.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.009054</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1810</th>
      <td>1811</td>
      <td>POLYGON ((474406.945 2140353.439, 474418.850 2...</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001214</td>
    </tr>
    <tr>
      <th>1811</th>
      <td>1812</td>
      <td>POLYGON ((477048.978 2143204.554, 477054.695 2...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1812</th>
      <td>1813</td>
      <td>POLYGON ((473081.154 2138733.281, 473070.790 2...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.003104</td>
    </tr>
    <tr>
      <th>1813</th>
      <td>1814</td>
      <td>POLYGON ((477329.014 2144260.214, 477335.725 2...</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001591</td>
    </tr>
    <tr>
      <th>1814</th>
      <td>1815</td>
      <td>POLYGON ((475172.282 2139719.331, 475190.495 2...</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>1815 rows × 6 columns</p>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Los métodos para agregar conservan las columnas que ya existen en la capa</p>
</div>
</div>
</section>
<section id="agregar-variables-del-censo" class="level3">
<h3 class="anchored" data-anchor-id="agregar-variables-del-censo">Agregar variables del censo</h3>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L529" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="usodesuelo.agrega_manzanas" class="level3">
<h3 class="anchored" data-anchor-id="usodesuelo.agrega_manzanas">UsoDeSuelo.agrega_manzanas</h3>
<blockquote class="blockquote">
<pre><code> UsoDeSuelo.agrega_manzanas (manzanas:geopandas.geodataframe.GeoDataFrame,
                             variables:dict, tipo_var:str='uso')</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>manzanas</td>
<td>GeoDataFrame</td>
<td></td>
<td>Las manzanas (<code>descarga_manzanas_ejempolo</code>).</td>
</tr>
<tr class="even">
<td>variables</td>
<td>dict</td>
<td></td>
<td>Diccionario de las variables que querems agregar y el método para agregarlas (p, ej. {‘OCUPVIVPAR’:‘sum’})</td>
</tr>
<tr class="odd">
<td>tipo_var</td>
<td>str</td>
<td>uso</td>
<td>uso/mc ¿qué tipo de variable estamos agregando</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>UsoDeSuelo</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Agregamos variables del Censo en la capa de uso de suelo que construimos usando una malla.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>usos_malla <span class="op">=</span> usos_malla.agrega_manzanas(manzanas, </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>                                    {<span class="st">'VIVPAR_HAB'</span>: <span class="st">'sum'</span>, </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'OCUPVIVPAR'</span>: <span class="st">'mean'</span>},</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                                    tipo_var<span class="op">=</span><span class="st">'uso'</span>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> usos_malla.soporte.datos.plot(<span class="st">'VIVPAR_HAB'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> ax1.set_title(<span class="st">"SUM VIVPAR_HAB"</span>)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> usos_malla.soporte.datos.plot(<span class="st">'OCUPVIVPAR'</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax2.set_title(<span class="st">"MEAN OCUPVIVPAR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-67-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Y verificamos las variables que tenemos en uso de suelo y medio construido</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(usos_malla.vars_uso, usos_malla.vars_mc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Comercio', 'Oficinas', 'Manufacturas', 'VIVPAR_HAB', 'OCUPVIVPAR'] ['metros_vialidad']</code></pre>
</div>
</div>
<p>Lo mismo podemos hacer para el caso de objetos construidos con soporte en polígonos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>uso_vars_poli <span class="op">=</span> uso_vars_poli.agrega_manzanas(manzanas, </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>                                    {<span class="st">'VIVPAR_HAB'</span>: <span class="st">'sum'</span>, </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'OCUPVIVPAR'</span>: <span class="st">'mean'</span>},</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                                    tipo_var<span class="op">=</span><span class="st">'uso'</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> uso_vars_poli.soporte.datos.plot(<span class="st">'VIVPAR_HAB'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> ax1.set_title(<span class="st">"SUM VIVPAR_HAB"</span>)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> uso_vars_poli.soporte.datos.plot(<span class="st">'OCUPVIVPAR'</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax2.set_title(<span class="st">"MEAN OCUPVIVPAR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-69-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Una vez más, revisamos las variables que tenemos guardadas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(uso_vars_poli.vars_uso, uso_vars_poli.vars_mc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Comercio', 'Oficinas', 'Manufacturas', 'VIVPAR_HAB', 'OCUPVIVPAR'] ['metros_vialidad']</code></pre>
</div>
</div>
</section>
<section id="calcular-mezclas" class="level3">
<h3 class="anchored" data-anchor-id="calcular-mezclas">Calcular mezclas</h3>
<p>Dentro del estudio de uso de suelo en ciudades es muy importante calcular índices para estimar la mezcla de usos de suelo. Para esto, la librería nos provee métodos para calcular dos índices muy usados en la literatura: intensidad y entropía. La intensidad mide qué tan usado está el suelo en cada unidad y es simplemente la suma de todos los usos, mientras que la entropía mide qué tan mezclados están los usos, usando la siguiente fórmula:</p>
<p><span class="math display">\[
E = -\sum _{j} \frac{p_j*ln(p_j)}{ln(J)}
\]</span></p>
<p>donde <span class="math inline">\(j\)</span> es un índice sobre cada tipo diferente de uso de suelo, <span class="math inline">\(p_j\)</span> es la proporción del j-ésimo uso con respecto al total y <span class="math inline">\(J\)</span> es la cantidad de usos de suelo considerados. La entropía varía entre 0 y 1, donde valores cercanos a 1 indican mayor mezcla y cercanos a 0 mayor homogeneidad.</p>
<hr>
<p><a href="https://github.com/CentroGeo/pyLandUseMX/blob/master/pyLandUseMX/usodesuelo.py#L547" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="usodesuelo.calcula_mezclas" class="level3">
<h3 class="anchored" data-anchor-id="usodesuelo.calcula_mezclas">UsoDeSuelo.calcula_mezclas</h3>
<blockquote class="blockquote">
<pre><code> UsoDeSuelo.calcula_mezclas ()</code></pre>
</blockquote>
<p>Vamos a usar el soporte de polígonos en el que calculamos usos de suelo utilizando pesos para calcular las variables de mezcla</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>usos_mezcla <span class="op">=</span> UsoDeSuelo(agregado_pesos, vars_uso<span class="op">=</span>[<span class="st">'Comercio'</span>, <span class="st">'Oficinas'</span>, <span class="st">'Manufacturas'</span>])</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>usos_mezcla <span class="op">=</span> usos_mezcla.calcula_mezclas()</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>fig, (ax0, ax1) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>ax0 <span class="op">=</span> usos_mezcla.soporte.datos.plot(<span class="st">'entropia'</span>, ax<span class="op">=</span>ax0)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>ax0 <span class="op">=</span> ax0.set_title(<span class="st">"Entropia"</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> usos_mezcla.soporte.datos.plot(<span class="st">'intensidad'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> ax1.set_title(<span class="st">"Intensidad"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_usodesuelo_files/figure-html/cell-72-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Además, en la propiedad <code>indices</code> de la clase se guardan las columnas con los índices que hemos calculado</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>usos_mezcla.indices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['entropia', 'intensidad']</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>